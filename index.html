<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Training Access</title>
  <style>
    :root { font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    body { margin: 0; background: #fff; }
    .card { max-width: 720px; margin: 2rem auto; background: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,.08); }
    label { display: block; margin: 0 0 1rem; font-weight: 600; }
    input { display: block; width: 100%; margin-top: .25rem; padding: .6rem .75rem; border: 1px solid #d0d6dd; border-radius: 8px; }
    button { padding: .6rem 1rem; border: 0; border-radius: 8px; background: black; color: white; font-weight: 700; cursor: pointer; }
    .link { text-decoration: none; font-weight: 600; }
    .link:hover { text-decoration: underline; }
    .error { color: #c62828; font-weight: 600; margin-top: .75rem; }
    .muted { color: #6b7280; margin-top: .75rem; }
  </style>
</head>
<body>
  <main class="card">
    <h1>Training Series</h1>
    <p>Please enter your name and the access password.</p>

    <form id="gateForm">
      <label>
        Your name
        <input id="name" name="name" type="text" required />
      </label>

      <label>
        Password
        <input id="password" name="password" type="password" inputmode="text" required />
      </label>

      <button type="submit">Enter</button>
      <p id="error" class="error" role="alert" aria-live="polite"></p>
      <p class="muted" id="help"></p>
    </form>
  </main>

  <script>
  // --- Config ---
  const PASSWORD_PLAIN = "cooldemo";
  const EMAIL_OWNER = "Kenley.richardson@gmail.com";
  const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbyB23AOVKrraH3h23YR-QCrrl5pVO4qUWDX1tmp84htriq0xxKDqwA0wHCNK15rHAMh/exec";

  // --- Helpers ---
  window.gate = (() => {
    function isAuthed(){ return sessionStorage.getItem('authed') === 'true'; }
    function requireAuthOrRedirect(){ if(!isAuthed()) location.href = "index.html"; }
    return { isAuthed, requireAuthOrRedirect };
  })();

  document.getElementById('help').innerHTML =
    `Need help? <a href="mailto:${encodeURIComponent(EMAIL_OWNER)}?subject=${encodeURIComponent('Training access help')}">Email ${EMAIL_OWNER}</a>`;

  const form = document.getElementById('gateForm');
  const nameInput = document.getElementById('name');
  const passInput = document.getElementById('password');
  const errorEl = document.getElementById('error');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorEl.textContent = "";

    const name = nameInput.value.trim();
    const pass = passInput.value;

    try {
      if (pass === PASSWORD_PLAIN) {
        sessionStorage.setItem('authed', 'true');
        sessionStorage.setItem('visitorName', name);

        // Send webhook email
        try {
          fetch(WEBHOOK_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name,
              ts: new Date().toISOString(),
              ua: navigator.userAgent,
              page: location.href
            })
          });
        } catch (_) {}

        // Go to videos page
        location.href = "videos.html";
      } else {
        errorEl.textContent = "Incorrect password. Please try again.";
      }
    } catch (err) {
      console.error(err);
      errorEl.textContent = "Something went wrong. Please try again.";
    }
  });
  </script>
</body>
</html>